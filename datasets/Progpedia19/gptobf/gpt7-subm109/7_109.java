// Original code omitted for brevity, see original instruction for details.